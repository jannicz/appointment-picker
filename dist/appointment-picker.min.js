!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("appointment-picker",[],function(){return t()}):e.AppointmentPicker=t()}(this,function(){"use strict";var e=function(e,t){this.options={interval:60,minTime:0,maxTime:24,startTime:0,endTime:24,disabled:[],mode:"24h",large:!1,leadingZero:!1,allowReset:!0,title:"Timepicker",templateInner:'<li class="appo-picker-list-item {{disabled}}"><input type="button" tabindex="-1" value="{{time}}" {{disabled}}></li>',templateOuter:'<span class="appo-picker-title">{{title}}</span><ul class="appo-picker-list">{{innerHtml}}</ul>',timeFormat12:"H:M apm",timeFormat24:"H:M"},this.el=e,this.picker=null,this.isOpen=!1,this.isInDom=!1,this.time={},this.intervals=[],this.disabledArr=[],this.displayTime="",this.selectionEventFn=function(e){var t=this;if(!e.target.value)return;this.setTime(e.target.value),this.el.focus(),setTimeout(function(){t.close(null)},100)}.bind(this),this.changeEventFn=function(){this.setTime(this.el.value)}.bind(this),this.clickEventFn=function(){this.open()}.bind(this),this.closeEventFn=this.close.bind(this),this.openEventFn=this.open.bind(this),this.keyEventFn=function(e){var t=this.picker.querySelector('input[type="button"]:not([disabled])'),i=this.picker.querySelector("input.is-selected"),s=null;switch(e.keyCode){case 13:case 27:this.close(null);break;case 38:s=i?r(i.parentNode,-1):t.parentNode;break;case 40:s=i?r(i.parentNode,1):t.parentNode}s&&!s.firstChild.disabled&&(s.firstChild.classList.add("is-selected"),i&&i.classList.remove("is-selected"),this.setTime(s.firstChild.value))}.bind(this),this.bodyFocusEventFn=function(e){if(!this.isOpen)return;this.close(e)}.bind(this),function(e,t,i){for(var n in i)e.options[n]=i[n];if(!e.el)return;if(void 0!==e.el.length)return void console.warn("appointment-picker: pass only one dom element as argument");if(e.options.interval>60)return void console.warn("appointment-picker: the maximal interval is 60");e.disabledArr=e.options.disabled.map(function(e){return s(e)});for(var r=0;r<60/e.options.interval;r++)e.intervals[r]=r*e.options.interval;e.setTime(e.el.value),t.addEventListener("keyup",e.keyEventFn),t.addEventListener("change",e.changeEventFn),t.addEventListener("focus",e.openEventFn)}(this,e,t||{})};function t(e,t,i,s,n){var r=!1;return!(e<i.minTime||e>i.maxTime||e>24)&&(!(e===i.maxTime&&t>0)&&(!(s.indexOf(t)<0)&&(n.forEach(function(i,s){i.h===e&&i.m===t&&(r=!0)}),!r)))}function i(e){return/^[0-9]{1}$/.test(e)?"0"+e:e}function s(e){if(e){var t=e.match(/^\s*([\d]{1,2})\D?([\d]{2})\W?(a|p)?.*$/i);if(t){var i=Number(t[1]),s=Number(t[2]),n=t[3];return/p/i.test(n)&&12!==i?i+=12:/a/i.test(n)&&12===i&&(i=0),{h:i,m:s}}}}function n(e,t,s,n,r){var o=e;return n&&(e>12?o=e-12:0==e&&(o=12),s=s.replace(e<12?/p/i:/a/i,"")),s.replace("H",r?i(o):o).replace("M",i(t))}function r(e,t){if(!e)return null;var i=t<0?e.previousElementSibling:e.nextElementSibling;return i&&i.className.indexOf("disabled")<0?i:r(i,t)}function o(e,t,i,s){var n=document.createEvent("Event");n.initEvent(t+".appo.picker",!0,!0),n.time=i,n.displayTime=s,e.dispatchEvent(n)}return e.prototype.render=function(){if(this.isOpen&&this.isInDom){var e=this.el.offsetTop+this.el.offsetHeight,t=this.el.offsetLeft,i=this.picker.querySelector("input.is-selected");if(this.picker.classList.add("is-open"),this.el.classList.add("is-expanded"),i&&i.classList.remove("is-selected"),this.time.hasOwnProperty("h")){var s=this.picker.querySelector('[value="'+this.displayTime+'"]');s&&s.classList.add("is-selected")}this.picker.style.top=e+"px",this.picker.style.left=t+"px"}else this.isInDom&&(this.picker.classList.remove("is-open"),this.el.classList.remove("is-expanded"))},e.prototype.open=function(){var e=this;this.isOpen||(this.isInDom||(this.picker=function(e){var i=document.createElement("div");return i.innerHTML=function(e,i,s){for(var r=e.startTime,o=e.endTime,l="",a="12h"===e.mode,c=a?e.timeFormat12:e.timeFormat24,h=r;h<o;h++)for(var p=0;p<i.length;p++){var d=i[p],m=!t(h,d,e,i,s),u=n(h,d,c,a,e.leadingZero);l+=e.templateInner.replace("{{time}}",u).replace(/{{disabled}}/gi,m?"disabled":"")}return e.templateOuter.replace("{{classes}}",e.large?"is-large":"").replace("{{title}}",e.title).replace("{{innerHtml}}",l)}(e.options,e.intervals,e.disabledArr),i.className="appo-picker"+(e.options.large?" is-large":""),i.setAttribute("aria-hidden",!0),e.el.insertAdjacentElement("afterend",i),i}(e),this.isInDom=!0),this.isOpen=!0,this.render(),this.picker.addEventListener("click",this.selectionEventFn),this.picker.addEventListener("keyup",this.keyEventFn),this.el.removeEventListener("click",this.clickEventFn),o(this.el,"open",this.time,this.displayTime),setTimeout(function(){document.body.addEventListener("click",e.closeEventFn),document.body.addEventListener("focus",e.bodyFocusEventFn,!0)},100))},e.prototype.close=function(e){if(this.isOpen){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),e){var t=e.target;if(t.isEqualNode(this.el))return;for(;t;){if(t.matches(".appo-picker"))return;t=t.parentElement}}this.isOpen=!1,this.render(),this.picker.removeEventListener("click",this.selectionEventFn),this.picker.removeEventListener("keyup",this.keyEventFn),document.body.removeEventListener("click",this.closeEventFn),document.body.removeEventListener("focus",this.bodyFocusEventFn,!0),this.el.addEventListener("click",this.clickEventFn),o(this.el,"close",this.time,this.displayTime)}},e.prototype.destroy=function(){this.close(null),this.picker&&(this.picker.parentNode.removeChild(this.picker),this.picker=null),this.el.removeEventListener("focus",this.openEventFn),this.el.removeEventListener("keyup",this.keyEventFn),this.el.removeEventListener("change",this.changeEventFn),this.el.removeEventListener("click",this.clickEventFn)},e.prototype.setTime=function(e){var i=s(e),r="24h"===this.options.mode,l=r?this.options.timeFormat24:this.options.timeFormat12;if(i||e||!this.options.allowReset){if(i){var a=t(i.h,i.m,this.options,this.intervals,this.disabledArr),c=this.options.leadingZero;a&&(this.time=i,this.displayTime=n(this.time.h,this.time.m,l,!r,c),o(this.el,"change",this.time,this.displayTime))}}else this.time={},this.displayTime="",o(this.el,"change",this.time,this.displayTime);this.render(),this.el.value=this.displayTime},e.prototype.getTime=function(){return{h:this.time.h,m:this.time.m,displayTime:this.displayTime}},e});